<div class="d-block">
  <div class="row">
    <div class="col-2">
      <h6 class="">{{ 'APP.TITLE.emails' | translate }}</h6>
    </div>
    <div class="col">
      <div class="btn-group btn-group-sm mb-1" *ngIf="!onlyRead">
        <ng-template [appHasPermission]="'TABEMAILCONTATTO'" [action]="'create'" [owner]="isOwner()">
          <a class="btn btn-cyan" (click)="onEdit($event, {})" tooltip="{{ 'APP.TOOLTIP.add_email' | translate }}" placement="bottom" container="body" [class.disabled]="!contactId">
            <i class="cui-plus"></i></a>
        </ng-template>
        <ng-template [appHasPermission]="'TABEMAILCONTATTO'" [action]="'edit'" [owner]="isOwner()">
          <a class="btn btn-cyan" (click)="onEdit($event, currentItem)" tooltip="{{ 'APP.TOOLTIP.modify_email' | translate }}" placement="bottom" container="body" [class.disabled]="!currentItem || !contactId">
            <i class="cui-pencil"></i></a>
        </ng-template>
        <ng-template [appHasPermission]="'TABEMAILCONTATTO'" [action]="'delete'" [owner]="isOwner()">
          <a class="btn btn-cyan" [class.disabled]="!currentItem || !contactId"
          tooltip="{{ 'APP.TOOLTIP.delete_email' | translate }}"
          container="body"
          mwlConfirmationPopover
          [popoverTitle]="'APP.TITLE.delete' | translate"
          [popoverMessage]="'APP.MESSAGE.are_you_sure' | translate"
          [cancelText]="'APP.BUTTON.cancel' | translate"
          [cancelButtonType]="'outline-secondary btn-sm'"
          [confirmText]="'APP.BUTTON.confirm' | translate"
          [confirmButtonType]="'danger btn-sm'"
          [appendToBody]="true"
          placement="bottom"
          (confirm)="onDelete(true)">
            <i class="icon-trash"></i></a>
        </ng-template>
      </div>
      <div class="btn-group btn-group-sm mb-1">
        <a class="btn btn-light" (click)="refresh()" tooltip="{{ 'APP.TOOLTIP.refresh' | translate }}" placement="bottom" container="body" [class.disabled]="!contactId">
          <i class="cui-reload"></i></a>
      </div>
    </div>
  </div>
</div>
<div class="d-block mb-1 position-relative">
  <!-- <pre class="pre-code"><code>{{ items | json }}</code></pre> -->
  <div class="border-left border-right border-bottom overflow-auto table-responsive box-height" [class.box-small]="small">
    <ngx-loading
      [show]="loading"
      [config]="loadingOptions">
    </ngx-loading>
    <table class="table table-sm table-hover" [class.small]="small">
      <thead>
        <tr class="" [class.small-]="small">
          <th scope="col">{{ 'APP.FIELD.descrizioneMail' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.email' | translate }}</th>
          <th class="text-center" scope="col">{{ 'APP.FIELD.isEmailFatturazione' | translate }}</th>
          <th class="text-center" scope="col">{{ 'APP.FIELD.isInvioDDT' | translate }}</th>
          <th scope="col" *ngIf="showListAction">&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <tr class="" [class.small-]="small" [class.table-warning]="item.id == currentItem?.id" (click)="setCurrentItem($event, item, idx)" *ngFor="let item of items;let idx = index;">
          <td scope="row">{{ item.anagDescEmail }}</td>
          <td>{{ item.email }}</td>
          <td class="text-center">
            <ion-icon class="align-middle text-blue" name="checkbox" *ngIf="item.isEmailFatturazione"></ion-icon>
            <ion-icon class="align-middle" name="square-outline" *ngIf="!item.isEmailFatturazione"></ion-icon>
          </td>
          <td class="text-center">
            <ion-icon class="align-middle text-blue" name="checkbox" *ngIf="item.isInvioDDT"></ion-icon>
            <ion-icon class="align-middle" name="square-outline" *ngIf="!item.isInvioDDT"></ion-icon>
          </td>
          <td class="text-right" *ngIf="showListAction">
            <span class="btn btn-sm py-0"><i class="cui-pencil" (click)="onEdit($event, item)" ></i></span>
            <!-- <span class="btn btn-sm py-0"><i class="cui-trash text-danger" (click)="onDelete($event, item)" ></i></span> -->
          </td>
        </tr>
        <tr class="no-hover" *ngIf="items?.length == 0">
          <td colspan="5" class="pt-5 pb-0 text-center">
            <div *ngIf="contactId && !error">{{ 'APP.MESSAGE.no_items' | translate }}</div>
            <div *ngIf="!contactId">
              <span class="p-3 mb-2 bg-warning text-dark">{{ 'APP.MESSAGE.no_contact_id' | translate }}</span>
            </div>
            <div *ngIf="error">
              <span class="bg-danger">{{ errorMessage }}</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="d-flex flex-column mb-3 border" style="min-height: 250px;" *ngIf="false">
  <div class="flex-grow-1 h-100">
    <div class="h-100" *ngIf="!currentItem && !loading">
      <div class="details-content h-100 mt-5">
        <div class="d-flex flex-column justify-content-center align-items-center h-75">
          <!-- loading & messages -->
          <div class="text-center" *ngIf="items?.length">
            <i class="icon-mouse icon-messages-50 message-small"></i>
            <h6 class="no-messages-text message-small mt-3">{{ 'APP.MESSAGE.select_email' | translate }}</h6>
          </div>
          <div class="text-center" *ngIf="!items?.length">
            <i class="icon-plus icon-messages-50 message-small"></i>
            <h6 class="no-messages-text message-small mt-3">{{ 'APP.MESSAGE.add_email' | translate }}</h6>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="currentItem" style="height: calc( 100% );">
      <!-- <pre class="pre-code"><code>{{ currentItem | json }}</code></pre> -->
      <app-item-attribute *ngFor="let field of currentItem | keyvalue"
        [attribute]="field"
        [excluded]="excluded"
        [hideEmpty]="true">
      </app-item-attribute>
    </div>
  </div>
</div>

<ng-template #editEmailModal>
  <form [formGroup]="dataForm" (ngSubmit)="onSave(dataModel)">
    <div class="modal-header">
      <h5 class="modal-title" *ngIf="!dataModel?.id">{{ 'APP.TITLE.new_email' | translate }}</h5>
      <h5 class="modal-title" *ngIf="dataModel?.id">{{ 'APP.TITLE.edit_email' | translate }}</h5>
      <button type="button" class="close" (click)="modalRef.hide()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <formly-form [form]="dataForm" [model]="dataModel" [fields]="dataFields">
      </formly-form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary btn-sm" type="submit" [disabled]="!dataForm?.valid">
        <span *ngIf="dataModel?.id == 0">{{ 'APP.BUTTON.save' | translate }}</span>
        <span *ngIf="dataModel?.id != 0">{{ 'APP.BUTTON.modify' | translate }}</span>
      </button>
    </div>
  </form>
</ng-template>
