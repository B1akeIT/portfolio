<div class="text-center py-3" *ngIf="loading">
  <div class="h1 text-muted text-center mt-5 mb-1">
    <i class="fa fa-circle-o-notch fa-spin"></i>
  </div>
</div>
<div class="h-75" *ngIf="!contact && !loading">
	<div class="details-content h-100">
    <div class="d-flex flex-column justify-content-center align-items-center h-100">
      <!-- loading & messages -->
      <div class="text-center" style="height: 120px;" *ngIf="!dragging">
        <ng-lottie [options]="options" (animationCreated)="animationCreated($event)"></ng-lottie>
      </div>
      <div class="text-center">
        <i class="icon-mouse icon-messages-50" *ngIf="dragging"></i>
        <h6 class="no-messages-text mt-3">{{ 'APP.MESSAGE.select_contact' | translate }}</h6>
      </div>
    </div>
	</div>
</div>
<div class="mt-3" *ngIf="contact && !loading">
  <div class="details-content">
    <!-- <div class="d-flex flex-column justify-content-center align-items-center mx-auto img-avatar bg-white border" [class.item-deactive]="!contact.isActive" [ngStyle]="{ 'background-image': 'url(assets/img/asset-avatar.gif)', 'background-repeat': 'no-repeat', 'background-size': 'cover', 'background-position': 'center center', 'margin-bottom': '0rem', 'width': '100px', 'height': '100px' }" *ngIf="showAvatar"></div> -->
    <div class="fab-button- fab-top- fab-right- text-center mb-2" *ngIf="logoBrand">
      <img [src]="logoBrand.src" [width]="logoBrand.width" [height]="logoBrand.height">
    </div>
    <div class="">
      <div class="text-center mt-4 mb-2">
        <i class="icon-messages-50-" *ngFor="let item of tipoContattoList"
          [ngClass]="{ 'cui-user text-warning': item == 'Agente', 'cui-euro text-danger': item == 'Cliente', 'cui-factory text-info': item == 'Fornitore', 'cui-boat-alt text-indigo': item == 'Unita' }" tooltip="{{ item | translate }}" placement="top" container="body"></i>
      </div>
      <div class="contact-name">{{ contact.ragioneSociale }}</div>
      <div class="contact-name">{{ contact.nome }} {{ contact.cognome }}</div>
      <div class="text-center small mb-2">{{ contact.id }}</div>
      <app-item-attribute *ngFor="let field of objectKey(contact)"
        [attribute]="{key: field, value: contact[field]}"
        [excluded]="excluded"
        [hideEmpty]="true">
      </app-item-attribute>

      <div *ngIf="isUnita()">
        <ng-container *ngFor="let field of contact.datiUnita | keyvalue">
          <app-item-attribute
            [attribute]="field"
            [excluded]="excludedForShip"
            [hideEmpty]="true">
          </app-item-attribute>
        </ng-container>
      </div>

      <mat-accordion class="mt-3">
        <ng-container *ngFor="let item of tipoContattoList">
          <ng-template [appHasPermission]="'TAB' + item" [action]="'view'" [owner]="true">
            <mat-expansion-panel *ngIf="item != 'Unita'"
              (opened)="beforePanelOpened(item)">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <i class="icon-messages-50 message-smaller" [ngClass]="{ 'cui-euro text-danger': item == 'Cliente', 'cui-factory text-info': item == 'Fornitore', 'cui-boat-alt text-indigo': item == 'Unita', 'cui-truck text-warning': item == 'Vettore' }"></i>
                </mat-panel-title>
                <mat-panel-description>{{ item }}</mat-panel-description>
              </mat-expansion-panel-header>
              <ng-template matExpansionPanelContent>
                <p class="text-center" *ngIf="loadings[item]"><i class="fa fa-circle-o-notch fa-spin"></i></p>
                <ng-container *ngIf="item != 'Vettore'">
                  <app-item-attribute *ngFor="let field of contactTypeData[item] | keyvalue"
                    [attribute]="field"
                    [excluded]="excluded"
                    [hideEmpty]="false">
                  </app-item-attribute>
                  <div class="mt-2 mb-3" *ngIf="contactTypeData[item]">
                    <ng-template [appHasPermission]="'TAB' + item" [action]="'view'" [owner]="true">
                      <h6 class="font-weight-bold" *ngIf="contactTypeData[item]?.aziendeContabilitaList?.length">{{ 'Dati Contabili' | translate }}</h6>
                      <mat-accordion class="mt-3">
                        <ng-container *ngFor="let acl of contactTypeData[item]?.aziendeContabilitaList">
                          <ng-template [appHasPermission]="'FUN' + item + 'CONTABILITA'" [action]="'view'" [owner]="acl.aziendaId == user?.aziendaId">
                            <mat-expansion-panel>
                              <mat-expansion-panel-header>
                                <mat-panel-title>
                                  <img [src]="acl.pathLogo" style="width: 36px;">
                                </mat-panel-title>
                              </mat-expansion-panel-header>
                              <ng-template matExpansionPanelContent>
                                <app-accounting-data
                                  [contactId]="contactTypeData[item].id"
                                  [aziendaId]="acl.aziendaId"
                                  [type]="item"
                                  [data]="acl">
                                </app-accounting-data>
                              </ng-template>
                            </mat-expansion-panel>
                          </ng-template>
                        </ng-container>
                      </mat-accordion>
                    </ng-template>
                    <ng-template [appHasPermission]="'TABUNITA'" [action]="'view'" [owner]="true">
                      <h6 class="font-weight-bold mt-3" *ngIf="contactTypeData[item].unitaList?.length && !isUnita()">{{ 'Unit√†' | translate }}</h6>
                      <mat-accordion class="mt-3" *ngIf="!isUnita()">
                        <mat-expansion-panel *ngFor="let ul of contactTypeData[item].unitaList">
                          <mat-expansion-panel-header>
                            <mat-panel-title>
                              {{ ul.name }}
                            </mat-panel-title>
                          </mat-expansion-panel-header>
                          <ng-template matExpansionPanelContent>
                            <app-unita-preview
                              [unitaId]="ul.unitaId"
                              [data]="ul">
                            </app-unita-preview>
                          </ng-template>
                        </mat-expansion-panel>
                      </mat-accordion>
                    </ng-template>
                  </div>
                </ng-container>
                <ng-container *ngIf="item == 'Vettore'">
                  <div class="mt-2 mb-3">
                    <mat-accordion class="mt-3">
                      <ng-container *ngFor="let al of contactTypeData[item]?.aziendeList">
                        <ng-template [appHasPermission]="'TAB' + item" [action]="'view'" [owner]="al.aziendaId == user?.aziendaId">
                          <mat-expansion-panel>
                            <mat-expansion-panel-header>
                              <mat-panel-title>
                                <img [src]="al.pathLogo" style="width: 36px;">
                              </mat-panel-title>
                            </mat-expansion-panel-header>
                            <ng-template matExpansionPanelContent>
                              <app-carrier-preview
                                [contattoId]="contactId"
                                [aziendaId]="al.aziendaId"
                                [data]="al">
                              </app-carrier-preview>
                            </ng-template>
                          </mat-expansion-panel>
                        </ng-template>
                      </ng-container>
                    </mat-accordion>
                  </div>
                </ng-container>
              </ng-template>
            </mat-expansion-panel>
          </ng-template>
        </ng-container>
      </mat-accordion>
    </div>
	</div>
</div>
