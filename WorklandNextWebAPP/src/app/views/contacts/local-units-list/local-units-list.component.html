<div class="d-block">
  <div class="row">
    <div class="col-2">
      <h6 class="">{{ 'APP.TITLE.local-units' | translate }}</h6>
    </div>
    <div class="col">
      <div class="btn-group btn-group-sm mb-1" *ngIf="!readOnly">
        <ng-template [appHasPermission]="'TABCONTATTOUNITALOCALE'" [action]="'create'" [owner]="true">
          <a class="btn btn-cyan" (click)="onEdit($event, {})" tooltip="{{ 'APP.TOOLTIP.add_local_unit' | translate }}" placement="bottom" container="body">
            <i class="cui-plus"></i></a>
        </ng-template>
        <ng-template [appHasPermission]="'TABCONTATTOUNITALOCALE'" [action]="'edit'" [owner]="true">
          <a class="btn btn-cyan" (click)="onEdit($event, currentItem)" tooltip="{{ 'APP.TOOLTIP.modify_local_unit' | translate }}" placement="bottom" container="body" [class.disabled]="!currentItem">
            <i class="cui-pencil"></i></a>
        </ng-template>
        <ng-template [appHasPermission]="'TABCONTATTOUNITALOCALE'" [action]="'delete'" [owner]="true">
          <a class="btn btn-cyan" [class.disabled]="!currentItem"
            tooltip="{{ 'APP.TOOLTIP.delete_local_unit' | translate }}"
            container="body"
            mwlConfirmationPopover
            [popoverTitle]="'APP.TITLE.delete' | translate"
            [popoverMessage]="'APP.MESSAGE.are_you_sure' | translate"
            [cancelText]="'APP.BUTTON.cancel' | translate"
            [cancelButtonType]="'outline-secondary btn-sm'"
            [confirmText]="'APP.BUTTON.confirm' | translate"
            [confirmButtonType]="'danger btn-sm'"
            [appendToBody]="true"
            placement="bottom"
            (confirm)="onDelete(true)">
            <i class="icon-trash"></i></a>
        </ng-template>
      </div>
      <div class="btn-group btn-group-sm mb-1">
        <a class="btn btn-light" (click)="refresh()" tooltip="{{ 'APP.TOOLTIP.refresh' | translate }}" placement="bottom" container="body">
          <i class="cui-reload"></i></a>
      </div>
    </div>
  </div>
</div>
<div class="d-block mb-1 position-relative">
  <!-- <pre class="pre-code"><code>{{ items | json }}</code></pre> -->
  <div class="border-left border-right border-bottom overflow-auto" style="min-height: 160px;">
    <ngx-loading
      [show]="loading"
      [config]="loadingOptions">
    </ngx-loading>
    <table class="table table-sm table-hover">
      <thead>
        <tr class="small">
          <th scope="col">{{ 'APP.FIELD.intestazione' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.indirizzo' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.comune' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.cap' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.provincia' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.nazione' | translate }}</th>
          <th class="text-center" scope="col">{{ 'APP.FIELD.isDefaultValue' | translate }}</th>
          <th scope="col" *ngIf="showListAction">&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <tr class="small" *ngFor="let item of items;let idx = index;" [class.table-warning]="item.id == currentItem?.id" (click)="setCurrentItem($event, item, idx)">
          <td scope="row">{{ item.intestazione }}</td>
          <td>{{ item.indirizzo }}</td>
          <td>{{ item.comune }}</td>
          <td>{{ item.cAP }}</td>
          <td>{{ item.provincia }}</td>
          <td>{{ item.anagNazioneDescrizione }}</td>
          <td class="text-center">
            <ion-icon class="align-middle text-blue" name="checkbox" *ngIf="item.isDefaultValue"></ion-icon>
            <ion-icon class="align-middle" name="square-outline" *ngIf="!item.isDefaultValue"></ion-icon>
          </td>
          <td class="text-right" *ngIf="showListAction">
            <span class="btn btn-sm py-0"><i class="cui-pencil" (click)="onEdit($event, item)" ></i></span>
            <!-- <span class="btn btn-sm py-0"><i class="cui-trash text-danger" (click)="onDelete($event, item)" ></i></span> -->
          </td>
        </tr>
        <tr *ngIf="items?.length == 0">
          <td colspan="8" class="py-4 text-center">{{ 'APP.MESSAGE.no_items' | translate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="d-flex flex-column mb-3 border" style="min-height: 250px;" *ngIf="false" >
  <div class="flex-grow-1 h-100">
    <div class="h-100" *ngIf="!currentItem && !loading">
      <div class="details-content h-100 mt-5">
        <div class="d-flex flex-column justify-content-center align-items-center h-75">
          <!-- loading & messages -->
          <div class="text-center" *ngIf="items?.length">
            <i class="icon-mouse icon-messages-50 message-small"></i>
            <h6 class="no-messages-text message-small mt-3">{{ 'APP.MESSAGE.select_local_unit' | translate }}</h6>
          </div>
          <div class="text-center" *ngIf="!items?.length">
            <i class="icon-plus icon-messages-50 message-small"></i>
            <h6 class="no-messages-text message-small mt-3">{{ 'APP.MESSAGE.add_local_unit' | translate }}</h6>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="currentItem" style="height: calc( 100% );">
      <!-- <pre class="pre-code"><code>{{ currentItem | json }}</code></pre> -->
      <app-item-attribute *ngFor="let field of currentItem | keyvalue"
        [attribute]="field"
        [excluded]="excluded"
        [hideEmpty]="true">
      </app-item-attribute>
    </div>
  </div>
</div>

<ng-template #editUnitModal>
  <form [formGroup]="dataForm" (ngSubmit)="onSave(dataModel)">
    <div class="modal-header">
      <h5 class="modal-title" *ngIf="!dataModel?.id">{{ 'APP.TITLE.new_local_unit' | translate }}</h5>
      <h5 class="modal-title" *ngIf="dataModel?.id">{{ 'APP.TITLE.edit_local_unit' | translate }}</h5>
      <button type="button" class="close" (click)="modalRef.hide()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <formly-form [form]="dataForm" [model]="dataModel" [fields]="dataFields">
      </formly-form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary btn-sm" type="submit" [disabled]="!dataForm?.valid">
        <span *ngIf="dataModel?.id == 0">{{ 'APP.BUTTON.save' | translate }}</span>
        <span *ngIf="dataModel?.id != 0">{{ 'APP.BUTTON.modify' | translate }}</span>
      </button>
    </div>
  </form>
</ng-template>
