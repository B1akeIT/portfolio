<!-- <pre class="pre-code" *ngIf="items"><code>{{ items | json }}</code></pre> -->
<ng-template [appHasPermission]="'FUNCLIENTECONTABILITACC'" [action]="'view'" [owner]="true">
  <div class="d-block">
    <div class="row">
      <div class="col-3 d-flex justify-content-left">
        <h6 class="ml-2 mr-3 mt-1" title="CC [cid:{{ clienteId }} | ccid: {{ clienteContabilitaId }}]">{{ 'APP.TITLE.credit-cards' | translate }}</h6>
        <ng-template [appHasPermission]="'FUNCLIENTECONTABILITACC'" [action]="'create'" [owner]="true">
          <div class="btn-group btn-group-sm mb-1" *ngIf="!readOnly">
            <a class="btn btn-cyan" (click)="onEdit($event, {})" tooltip="{{ 'APP.TOOLTIP.add_credit_card' | translate }}" placement="right" container="body">
              <i class="cui-plus"></i></a>
          </div>
        </ng-template>
      </div>
      <div class="col text-right">
        <div class="btn-group btn-group-sm mb-1">
          <span class="btn btn-light" (click)="getListCC()"><i class="cui-reload"></i></span>
        </div>
      </div>
    </div>
  </div>
  <div class="border-left border-right border-bottom position-relative" style="min-height: 150px;">
    <ngx-loading
      [show]="loading"
      [config]="loadingOptions">
    </ngx-loading>
    <table class="table table-sm table-hover">
      <thead>
        <tr>
          <th scope="col">{{ 'APP.FIELD.intestatarioCC' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.tipoCC' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.numeroCC' | translate }}</th>
          <th scope="col">{{ 'APP.FIELD.dataScadenzaCC' | translate }}</th>
          <th scope="col">&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items">
          <td class="align-middle" scope="row">{{ item.intestatarioCC }}</td>
          <td class="align-middle">{{ item.tipoCC }}</td>
          <td class="align-middle">{{ item.numeroCC }}</td>
          <td class="align-middle">{{ item.dataScadenzaCC | date: 'dd-MM-yyy' }}</td> <!-- :'mediumDate' -->
          <td class="text-right align-middle py-1" *ngIf="readOnly">&nbsp;</td>
          <td class="text-right align-middle py-1" *ngIf="!readOnly">
            <ng-template [appHasPermission]="'FUNCLIENTECONTABILITACC'" [action]="'edit'" [owner]="true">
              <span class="btn btn-sm btn-light" tooltip="{{ 'APP.TOOLTIP.edit_credit_card' | translate }}"
                container="body" placement="left"><i class="cui-pencil" (click)="onEdit($event, item)" ></i></span>
            </ng-template>
            <ng-template [appHasPermission]="'FUNCLIENTECONTABILITACC'" [action]="'delete'" [owner]="true">
              <button class="btn btn-sm btn-danger"
                tooltip="{{ 'APP.TOOLTIP.delete_credit_card' | translate }}"
                container="body"
                mwlConfirmationPopover
                [popoverTitle]="'APP.TITLE.delete' | translate"
                [popoverMessage]="'APP.MESSAGE.are_you_sure' | translate"
                [cancelText]="'APP.BUTTON.cancel' | translate"
                [cancelButtonType]="'outline-secondary btn-sm'"
                [confirmText]="'APP.BUTTON.confirm' | translate"
                [confirmButtonType]="'danger btn-sm'"
                [appendToBody]="true"
                placement="left"
                (confirm)="onDelete($event, item)">
                <i class="icon-trash"></i></button>
              <!-- <span class="btn btn-sm btn-danger"><i class="cui-trash" (click)="onDelete($event, item)" ></i></span> -->
            </ng-template>
          </td>
        </tr>
        <tr *ngIf="items?.length == 0">
          <td colspan="5" class="py-4 text-center">{{ 'APP.MESSAGE.no_items' | translate }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #editCCModal>
    <form [formGroup]="dataForm" (ngSubmit)="onSave(dataModel)">
      <div class="modal-header">
        <h5 class="modal-title" *ngIf="!dataModel?.id">{{ 'APP.TITLE.new_credit_card' | translate }}</h5>
        <h5 class="modal-title" *ngIf="dataModel?.id">{{ 'APP.TITLE.edit_credit_card' | translate }}</h5>
        <button type="button" class="close" (click)="modalCCRef.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <formly-form [form]="dataForm" [model]="dataModel" [fields]="dataFields">
        </formly-form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary btn-sm" type="submit" [disabled]="!dataForm?.valid">
          <span *ngIf="dataModel?.id == 0">{{ 'APP.BUTTON.save' | translate }}</span>
          <span *ngIf="dataModel?.id != 0">{{ 'APP.BUTTON.modify' | translate }}</span>
        </button>
      </div>
    </form>
  </ng-template>
</ng-template>
